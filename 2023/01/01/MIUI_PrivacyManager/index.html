<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="前言一直好奇，MIUI的隐私行为咋做的，但是一直没有什么动力去分析。目前公司有个新的活，做出来一套无侵入式的隐私分析沙箱，一开始认为单纯的填写相应API代码就行了，后来实操下来发现真的太天真了，那个UID调用的API无从知晓，而且无法控制UID，所以突然想看看MIUI的隐私行为咋做的，才有这篇小文章。 过程一开始肯定要定位那个App具体实现了隐私行为功能了，所以直接用adb的命令直接获取到隐私行为">
<meta property="og:type" content="article">
<meta property="og:title" content="MIUI隐私行为逆向分析">
<meta property="og:url" content="http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/index.html">
<meta property="og:site_name" content="TUGOhost">
<meta property="og:description" content="前言一直好奇，MIUI的隐私行为咋做的，但是一直没有什么动力去分析。目前公司有个新的活，做出来一套无侵入式的隐私分析沙箱，一开始认为单纯的填写相应API代码就行了，后来实操下来发现真的太天真了，那个UID调用的API无从知晓，而且无法控制UID，所以突然想看看MIUI的隐私行为咋做的，才有这篇小文章。 过程一开始肯定要定位那个App具体实现了隐私行为功能了，所以直接用adb的命令直接获取到隐私行为">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-01-01T02:28:25.000Z">
<meta property="article:modified_time" content="2023-10-11T03:46:21.844Z">
<meta property="article:author" content="TUGOhost">
<meta property="article:tag" content="逆向">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>MIUI隐私行为逆向分析</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/TUGOhost">Projects</a></li><!--
     --><!--
       --><li><a href="/books/">books</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/01/11/asiaccs22_mantovani/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/12/06/VMProtect2_detailed_analysis_of_the_virtual_machine_architecture/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&text=MIUI隐私行为逆向分析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&title=MIUI隐私行为逆向分析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&is_video=false&description=MIUI隐私行为逆向分析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=MIUI隐私行为逆向分析&body=Check out this article: http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&title=MIUI隐私行为逆向分析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&title=MIUI隐私行为逆向分析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&title=MIUI隐私行为逆向分析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&title=MIUI隐私行为逆向分析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&name=MIUI隐私行为逆向分析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&t=MIUI隐私行为逆向分析"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">过程</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        MIUI隐私行为逆向分析
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">TUGOhost</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-01-01T02:28:25.000Z" class="dt-published" itemprop="datePublished">2023-01-01</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E9%80%86%E5%90%91/" rel="tag">逆向</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一直好奇，MIUI的隐私行为咋做的，但是一直没有什么动力去分析。目前公司有个新的活，做出来一套无侵入式的隐私分析沙箱，一开始认为单纯的填写相应API代码就行了，后来实操下来发现真的太天真了，那个UID调用的API无从知晓，而且无法控制UID，所以突然想看看MIUI的隐私行为咋做的，才有这篇小文章。</p>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>一开始肯定要定位那个App具体实现了隐私行为功能了，所以直接用adb的命令直接获取到隐私行为界面是在那个App下，然后从手机中提取出apk，再对apk内容进行分析。</p>
<blockquote>
<p>adb shell dumpsys window | Select-String  mCurrentFocus</p>
<p>mCurrentFocus&#x3D;Window{d559062 mode&#x3D;0 rootTaskId&#x3D;378 u0 com.miui.securitycenter&#x2F;com.miui.permcenter.settings.PrivacySettingsActivity}</p>
</blockquote>
<p><code>com.miui.securitycenter/com.miui.permcenter.settings.PrivacySettingsActivity</code>这也就是隐私行为的主界面了，所以直接提取出安全中心apk即可。</p>
<p>简单分析了下，</p>
<p>com.miui.permcenter.privacymanager.k.a 单个行为的具体细节</p>
<p>com.miui.permcenter.privacymanager.behaviorrecord.b.b.a App行为时间线</p>
<p>其中包含了应用图标、应用名称、应用行为名称、行为发生的时间、行为时间线（MIUI自己的时间线UI功能，不多做赘述）。</p>
<p>com.miui.permcenter.privacymanager.k.a是主要的行为内容部分，所以掌握这块内容从哪里传过来的就很好办了。</p>
<p>com.miui.permcenter.privacymanager.k.a v0 &#x3D; (com.miui.permcenter.privacymanager.k.a)this.b.get(arg9);  &#x2F;&#x2F; 设置行为信息</p>
<p>com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity &#x2F;&#x2F; App behavior的界面</p>
<p>其中调用com.miui.permcenter.privacymanager.k.a 的为 this.f.add(new a());</p>
<p>com.miui.permcenter.privacymanager.behaviorrecord.c.a &#x2F;&#x2F; 调用com.miui.permcenter.privacymanager.k.a 并进行初始化</p>
<p>静态分析看了半天，直接用frida trace下吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">*** exiting com.miui.permcenter.privacymanager.k.a.a</span><br><span class="line">========================================================================================================================================================================================================Inspecting Fields: =&gt; true =&gt; class com.miui.permcenter.privacymanager.k.a</span><br><span class="line">java.lang.String 	a =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	b =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	c =&gt; undefined =&gt; undefined</span><br><span class="line">long 	d =&gt; undefined =&gt; undefined</span><br><span class="line">int 	e =&gt; undefined =&gt; undefined</span><br><span class="line">int 	f =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	g =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	h =&gt; undefined =&gt; undefined</span><br><span class="line">int 	i =&gt; undefined =&gt; undefined</span><br><span class="line">int 	j =&gt; undefined =&gt; undefined</span><br><span class="line">int 	k =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.CharSequence 	l =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.CharSequence 	m =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	n =&gt; undefined =&gt; undefined</span><br><span class="line">int 	o =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	p =&gt; null =&gt; null</span><br><span class="line">int 	q =&gt; 0 =&gt; 0</span><br><span class="line">com.miui.appmanager.i 	r =&gt; null =&gt; null</span><br><span class="line">int 	s =&gt; 0 =&gt; 0</span><br><span class="line">java.lang.String 	t =&gt; null =&gt; null</span><br><span class="line">java.util.List 	u =&gt; null =&gt; null</span><br><span class="line">boolean 	v =&gt; false =&gt; false</span><br><span class="line">[Ljava.lang.reflect.Field;@79b8e47 	[Ljava.lang.reflect.Field;@79b8e47 =&gt; undefined =&gt; undefined</span><br><span class="line">[native 	function d() &#123;</span><br><span class="line">    [native code]</span><br><span class="line">&#125; =&gt; undefined =&gt; undefined</span><br><span class="line"></span><br><span class="line">*** entered com.miui.permcenter.privacymanager.k.a.a</span><br><span class="line">arg[0]: com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity@1a85b4a =&gt; &quot;&lt;instance: android.content.Context, $className: com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity&gt;&quot;</span><br><span class="line">java.lang.Throwable</span><br><span class="line">	at com.miui.permcenter.privacymanager.k.a.a(Native Method)</span><br><span class="line">	at com.miui.permcenter.privacymanager.k.a.&lt;init&gt;(Unknown Source:77)</span><br><span class="line">	at com.miui.permcenter.privacymanager.k.a.&lt;init&gt;(Native Method)</span><br><span class="line">	at com.miui.permcenter.privacymanager.behaviorrecord.c.a(Unknown Source:347)</span><br><span class="line">	at com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity.a(Unknown Source:68)</span><br><span class="line">	at com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity.a(Unknown Source:0)</span><br><span class="line">	at com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity$m.z(Unknown Source:44)</span><br><span class="line">	at com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity$m.z(Unknown Source:0)</span><br><span class="line">	at a.j.b.a.A(Unknown Source:0)</span><br><span class="line">	at c.c.d.n.c.A(Unknown Source:0)</span><br><span class="line">	at a.j.b.a$a.a(Unknown Source:2)</span><br><span class="line">	at a.j.b.a$a.a(Unknown Source:2)</span><br><span class="line">	at a.j.b.d$b.call(Unknown Source:18)</span><br><span class="line">	at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:923)</span><br><span class="line"></span><br><span class="line">retval: undefined =&gt; undefined</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">*** exiting com.miui.permcenter.privacymanager.k.a.a</span><br><span class="line">========================================================================================================================================================================================================Inspecting Fields: =&gt; true =&gt; class com.miui.permcenter.privacymanager.k.a</span><br><span class="line">java.lang.String 	a =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	b =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	c =&gt; undefined =&gt; undefined</span><br><span class="line">long 	d =&gt; undefined =&gt; undefined</span><br><span class="line">int 	e =&gt; undefined =&gt; undefined</span><br><span class="line">int 	f =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	g =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	h =&gt; undefined =&gt; undefined</span><br><span class="line">int 	i =&gt; undefined =&gt; undefined</span><br><span class="line">int 	j =&gt; undefined =&gt; undefined</span><br><span class="line">int 	k =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.CharSequence 	l =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.CharSequence 	m =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	n =&gt; undefined =&gt; undefined</span><br><span class="line">int 	o =&gt; undefined =&gt; undefined</span><br><span class="line">java.lang.String 	p =&gt; null =&gt; null</span><br><span class="line">int 	q =&gt; 0 =&gt; 0</span><br><span class="line">com.miui.appmanager.i 	r =&gt; null =&gt; null</span><br><span class="line">int 	s =&gt; 0 =&gt; 0</span><br><span class="line">java.lang.String 	t =&gt; null =&gt; null</span><br><span class="line">java.util.List 	u =&gt; null =&gt; null</span><br><span class="line">boolean 	v =&gt; false =&gt; false</span><br><span class="line">[Ljava.lang.reflect.Field;@bc0f586 	[Ljava.lang.reflect.Field;@bc0f586 =&gt; undefined =&gt; undefined</span><br><span class="line">[native 	function d() &#123;</span><br><span class="line">    [native code]</span><br><span class="line">&#125; =&gt; undefined =&gt; undefined</span><br><span class="line"></span><br><span class="line">*** entered com.miui.permcenter.privacymanager.k.a.$init</span><br><span class="line">arg[0]: com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity@1a85b4a =&gt; &quot;&lt;instance: android.content.Context, $className: com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity&gt;&quot;</span><br><span class="line">arg[1]: com.tencent.mm =&gt; &quot;com.tencent.mm&quot;</span><br><span class="line">arg[2]: com.tencent.mm =&gt; &quot;com.tencent.mm&quot;</span><br><span class="line">arg[3]: null =&gt; &quot;null&quot;</span><br><span class="line">arg[4]: 35184372088832 =&gt; &quot;35184372088832&quot;</span><br><span class="line">arg[5]: 0 =&gt; 0</span><br><span class="line">arg[6]: 1 =&gt; 1</span><br><span class="line">arg[7]: 2022-12-30 09:40 =&gt; &quot;2022-12-30 09:40&quot;</span><br><span class="line">arg[8]: 2022-12-30 09:40 =&gt; &quot;2022-12-30 09:40&quot;</span><br><span class="line">arg[9]: 1 =&gt; 1</span><br><span class="line">arg[10]: 0 =&gt; 0</span><br><span class="line">arg[11]: 0 =&gt; 0</span><br><span class="line">arg[12]: 0 =&gt; 0</span><br><span class="line">java.lang.Throwable</span><br><span class="line">	at com.miui.permcenter.privacymanager.k.a.&lt;init&gt;(Native Method)</span><br><span class="line">	at com.miui.permcenter.privacymanager.behaviorrecord.c.a(Unknown Source:347)</span><br><span class="line">	at com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity.a(Unknown Source:68)</span><br><span class="line">	at com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity.a(Unknown Source:0)</span><br><span class="line">	at com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity$m.z(Unknown Source:44)</span><br><span class="line">	at com.miui.permcenter.privacymanager.behaviorrecord.AppBehaviorRecordActivity$m.z(Unknown Source:0)</span><br><span class="line">	at a.j.b.a.A(Unknown Source:0)</span><br><span class="line">	at c.c.d.n.c.A(Unknown Source:0)</span><br><span class="line">	at a.j.b.a$a.a(Unknown Source:2)</span><br><span class="line">	at a.j.b.a$a.a(Unknown Source:2)</span><br><span class="line">	at a.j.b.d$b.call(Unknown Source:18)</span><br><span class="line">	at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:923)</span><br><span class="line"></span><br><span class="line">retval: undefined =&gt; undefined</span><br><span class="line">*** exiting com.miui.permcenter.privacymanager.k.a.$init</span><br></pre></td></tr></table></figure>

<p>其中的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">a</span><span class="params">(Context arg35, String arg36, <span class="type">int</span> arg37, <span class="meta">@NonNull</span> List arg38, <span class="type">int</span>[] arg39)</span> &#123;</span><br><span class="line">    <span class="type">int</span> v25;</span><br><span class="line">    Cursor v29_1;</span><br><span class="line">    String v22_1;</span><br><span class="line">    String v21_1;</span><br><span class="line">    <span class="type">int</span> v20_1;</span><br><span class="line">    <span class="type">int</span> v10_1;</span><br><span class="line">    List v2_2;</span><br><span class="line">    <span class="type">long</span> v33;</span><br><span class="line">    <span class="type">int</span> v32;</span><br><span class="line">    <span class="type">int</span> v31_1;</span><br><span class="line">    <span class="type">int</span> v23;</span><br><span class="line">    <span class="type">int</span> v24;</span><br><span class="line">    <span class="type">int</span> v3_2;</span><br><span class="line">    <span class="type">int</span> v1_4;</span><br><span class="line">    <span class="type">int</span> v7;</span><br><span class="line">    <span class="type">long</span> v17;</span><br><span class="line">    String v5;</span><br><span class="line">    String v4_1;</span><br><span class="line">    Cursor v6;</span><br><span class="line">    String v22;</span><br><span class="line">    <span class="type">int</span> v1_1;</span><br><span class="line">    StringBuilder v3_1;</span><br><span class="line">    String v4;</span><br><span class="line">    <span class="type">Cursor</span> <span class="variable">v29</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Context</span> <span class="variable">v0</span> <span class="operator">=</span> arg35;</span><br><span class="line">    <span class="type">List</span> <span class="variable">v15</span> <span class="operator">=</span> arg38;</span><br><span class="line">    <span class="type">int</span>[] v1 = arg39;</span><br><span class="line">    <span class="type">long</span> <span class="variable">v13</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">v16</span> <span class="operator">=</span> c.f(arg35);</span><br><span class="line">    String[] v2 = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;pkgName&quot;</span>, <span class="string">&quot;calleePkg&quot;</span>, <span class="string">&quot;permissionId&quot;</span>, <span class="string">&quot;mode&quot;</span>, <span class="string">&quot;processState&quot;</span>, <span class="string">&quot;startTime&quot;</span>, <span class="string">&quot;endTime&quot;</span>, <span class="string">&quot;count&quot;</span>, <span class="string">&quot;user&quot;</span>&#125;;</span><br><span class="line">    <span class="type">int</span> <span class="variable">v12</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    String[] v3 = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">v11</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    v3[<span class="number">0</span>] = arg36;</span><br><span class="line">    <span class="type">int</span> <span class="variable">v10</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    v3[<span class="number">1</span>] = String.valueOf(arg37);</span><br><span class="line">    <span class="type">int</span> <span class="variable">v9</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">v8</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span>(v16) &#123;</span><br><span class="line">        v2 = (String[])Arrays.copyOf(((Object[])v2), v2.length + <span class="number">1</span>);</span><br><span class="line">        v2[v2.length - <span class="number">1</span>] = <span class="string">&quot;calleeUser&quot;</span>;</span><br><span class="line">        v3 = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;arg36, String.valueOf(arg37), arg36, String.valueOf(arg37)&#125;;</span><br><span class="line">        v4 = <span class="string">&quot;(pkgName == ? AND user == ? ) OR ( calleePkg == ? AND calleeUser  == ? )&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        v4 = <span class="string">&quot;pkgName == ? AND user == ?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String[] v19 = v2;</span><br><span class="line">    String[] v21 = v3;</span><br><span class="line">    <span class="type">String</span> <span class="variable">v20</span> <span class="operator">=</span> v4;</span><br><span class="line">    <span class="keyword">if</span>(v1 == <span class="literal">null</span>) &#123;</span><br><span class="line">        v22 = <span class="string">&quot;endTime DESC , _id DESC&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(v1.length == <span class="number">1</span>) &#123;</span><br><span class="line">        v3_1 = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        v3_1.append(<span class="string">&quot;endTime DESC , _id DESC&quot;</span>);</span><br><span class="line">        v3_1.append(<span class="string">&quot; LIMIT &quot;</span>);</span><br><span class="line">        v1_1 = v1[<span class="number">0</span>];</span><br><span class="line">        goto label_76;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(v1.length == <span class="number">2</span>) &#123;</span><br><span class="line">            v3_1 = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            v3_1.append(<span class="string">&quot;endTime DESC , _id DESC&quot;</span>);</span><br><span class="line">            v3_1.append(<span class="string">&quot; LIMIT &quot;</span>);</span><br><span class="line">            v3_1.append(v1[<span class="number">0</span>]);</span><br><span class="line">            v3_1.append(<span class="string">&quot; OFFSET &quot;</span>);</span><br><span class="line">            v1_1 = v1[<span class="number">1</span>];</span><br><span class="line">        label_76:</span><br><span class="line">            v3_1.append(v1_1);</span><br><span class="line">            v22 = v3_1.toString();</span><br><span class="line">            goto label_83;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        v22 = <span class="string">&quot;endTime DESC , _id DESC&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">label_83:</span><br><span class="line">    <span class="type">Cursor</span> <span class="variable">v1_2</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        v6 = arg35.getContentResolver().query(PermissionContract.RECORD_URI, v19, v20, v21, v22);</span><br><span class="line">        goto label_91;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(Exception v0_1) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(Throwable v0_2) &#123;</span><br><span class="line">        v29 = v1_2;</span><br><span class="line">        miuix.core.util.d.a(v29);</span><br><span class="line">        <span class="keyword">throw</span> v0_2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">v31</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    goto label_260;</span><br><span class="line">label_91:</span><br><span class="line">    <span class="keyword">if</span>(v6 == <span class="literal">null</span>) &#123;</span><br><span class="line">        v29_1 = v6;</span><br><span class="line">        v31 = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">v1_3</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            label_93:</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">v2_1</span> <span class="operator">=</span> v6.moveToNext();</span><br><span class="line">                goto label_99;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception v0_1) &#123;</span><br><span class="line">            v29 = v6;</span><br><span class="line">            v31 = v1_3;</span><br><span class="line">            goto label_258;</span><br><span class="line">        label_99:</span><br><span class="line">            <span class="keyword">if</span>(!v2_1) &#123;</span><br><span class="line">                v29_1 = v6;</span><br><span class="line">                miuix.core.util.d.a(v29_1);</span><br><span class="line">                <span class="keyword">return</span> v1_3;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                v4_1 = v6.getString(v11);</span><br><span class="line">                v5 = v6.getString(v10);</span><br><span class="line">                v17 = v6.getLong(v12);</span><br><span class="line">                v7 = v6.getInt(<span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Exception v0_1) &#123;</span><br><span class="line">                goto label_256;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Throwable v0_2) &#123;</span><br><span class="line">                v29 = v6;</span><br><span class="line">                miuix.core.util.d.a(v29);</span><br><span class="line">                <span class="keyword">throw</span> v0_2;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(v16) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    v1_4 = v6.getInt(<span class="number">9</span>);</span><br><span class="line">                    goto label_113;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span>(Exception v0_1) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span>(Throwable v0_2) &#123;</span><br><span class="line">                    v29 = v6;</span><br><span class="line">                    miuix.core.util.d.a(v29);</span><br><span class="line">                    <span class="keyword">throw</span> v0_2;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                v1_2 = v6;</span><br><span class="line">                v31 = (<span class="type">boolean</span>)v10;</span><br><span class="line">                goto label_260;</span><br><span class="line">            label_113:</span><br><span class="line">                v3_2 = v1_4;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                v3_2 = arg37;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">v1_5</span> <span class="operator">=</span> c.c(v5);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Exception v0_1) &#123;</span><br><span class="line">                goto label_256;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Throwable v0_2) &#123;</span><br><span class="line">                v29 = v6;</span><br><span class="line">                miuix.core.util.d.a(v29);</span><br><span class="line">                <span class="keyword">throw</span> v0_2;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!v1_5) &#123;</span><br><span class="line">                goto label_125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(!c.e.containsKey(Long.valueOf(v17)) || (c.a(v0, v4_1, v7))) &#123;</span><br><span class="line">                    goto label_140;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            label_125:</span><br><span class="line">                <span class="keyword">if</span>(v1_5) &#123;</span><br><span class="line">                    goto label_149;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(v17 == <span class="number">2L</span> &amp;&amp; !c.g.containsKey(v4_1) || (c.a(v0, v5, v3_2))) &#123;</span><br><span class="line">                    goto label_140;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">boolean</span> <span class="variable">v1_6</span> <span class="operator">=</span> c.a(v0, v4_1, v5);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Exception v0_1) &#123;</span><br><span class="line">                v1_2 = v6;</span><br><span class="line">                v31 = <span class="literal">true</span>;</span><br><span class="line">                goto label_260;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Throwable v0_2) &#123;</span><br><span class="line">                v29 = v6;</span><br><span class="line">                miuix.core.util.d.a(v29);</span><br><span class="line">                <span class="keyword">throw</span> v0_2;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(v1_6) &#123;</span><br><span class="line">            label_140:</span><br><span class="line">                v29 = v6;</span><br><span class="line">                v24 = v8;</span><br><span class="line">                v23 = v9;</span><br><span class="line">                v31_1 = v11;</span><br><span class="line">                v32 = v12;</span><br><span class="line">                v33 = v13;</span><br><span class="line">                v2_2 = v15;</span><br><span class="line">                v19 = <span class="literal">null</span>;</span><br><span class="line">                goto label_273;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            label_149:</span><br><span class="line">                v10_1 = v6.getInt(v8);</span><br><span class="line">                v20_1 = v6.getInt(v9);</span><br><span class="line">                v21_1 = v6.getString(<span class="number">5</span>);</span><br><span class="line">                v22_1 = v6.getString(<span class="number">6</span>);</span><br><span class="line">                <span class="type">long</span> <span class="variable">v8_1</span> <span class="operator">=</span> c.a(v22_1);</span><br><span class="line">                <span class="keyword">if</span>(v8_1 &gt; v13) &#123;</span><br><span class="line">                    v29 = v6;</span><br><span class="line">                    v31_1 = v11;</span><br><span class="line">                    v32 = v12;</span><br><span class="line">                    v33 = v13;</span><br><span class="line">                    v2_2 = v15;</span><br><span class="line">                    v19 = <span class="literal">null</span>;</span><br><span class="line">                    v23 = <span class="number">4</span>;</span><br><span class="line">                    v24 = <span class="number">3</span>;</span><br><span class="line">                    goto label_273;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(c.a(v13, v8_1) &gt; <span class="number">6</span>) &#123;</span><br><span class="line">                    v29_1 = v6;</span><br><span class="line">                    v31 = <span class="literal">true</span>;</span><br><span class="line">                    goto label_288;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                v25 = v17 == <span class="number">0x20L</span> ? <span class="number">1</span> : v6.getInt(<span class="number">7</span>);</span><br><span class="line">                <span class="keyword">if</span>(v16) &#123;</span><br><span class="line">                    goto label_183;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    goto label_209;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                goto label_231;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Exception v0_1) &#123;</span><br><span class="line">                goto label_256;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Throwable v0_2) &#123;</span><br><span class="line">                v29 = v6;</span><br><span class="line">                miuix.core.util.d.a(v29);</span><br><span class="line">                <span class="keyword">throw</span> v0_2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Throwable v0_2) &#123;</span><br><span class="line">            v29 = v6;</span><br><span class="line">            miuix.core.util.d.a(v29);</span><br><span class="line">            <span class="keyword">throw</span> v0_2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    label_183:</span><br><span class="line">        <span class="type">Context</span> <span class="variable">v2_3</span> <span class="operator">=</span> arg35;</span><br><span class="line">        <span class="type">String</span> <span class="variable">v3_3</span> <span class="operator">=</span> arg36;</span><br><span class="line">        v29 = v6;</span><br><span class="line">        <span class="type">long</span> <span class="variable">v6_1</span> <span class="operator">=</span> v17;</span><br><span class="line">        v24 = <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v8_2</span> <span class="operator">=</span> v10_1;</span><br><span class="line">        v23 = <span class="number">4</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v9_1</span> <span class="operator">=</span> v20_1;</span><br><span class="line">        v19 = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">v10_2</span> <span class="operator">=</span> v21_1;</span><br><span class="line">        v31_1 = v11;</span><br><span class="line">        <span class="type">String</span> <span class="variable">v11_1</span> <span class="operator">=</span> v22_1;</span><br><span class="line">        v32 = v12;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v12_1</span> <span class="operator">=</span> v25;</span><br><span class="line">        v33 = v13;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v13_1</span> <span class="operator">=</span> v7;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v14</span> <span class="operator">=</span> v3_2;</span><br><span class="line">        <span class="type">List</span> <span class="variable">v0_3</span> <span class="operator">=</span> v15;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(v2_3, v3_3, v4_1, v5, v6_1, v8_2, v9_1, v10_2, v11_1, v12_1, v13_1, v14, <span class="number">1</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">v15_1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            goto label_231;</span><br><span class="line">        label_209:</span><br><span class="line">            v29 = v6;</span><br><span class="line">            v31_1 = v11;</span><br><span class="line">            v32 = v12;</span><br><span class="line">            v33 = v13;</span><br><span class="line">            v0_3 = v15;</span><br><span class="line">            v19 = <span class="literal">null</span>;</span><br><span class="line">            v23 = <span class="number">4</span>;</span><br><span class="line">            v24 = <span class="number">3</span>;</span><br><span class="line">            v15_1 = <span class="keyword">new</span> <span class="title class_">a</span>(arg35, arg36, v4_1, v5, v17, v10_1, v20_1, v21_1, v22_1, v25, arg37, <span class="number">1</span>);  <span class="comment">// 初始化</span></span><br><span class="line">        label_231:</span><br><span class="line">            <span class="keyword">if</span>(arg38.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                v0_3.add(v15_1);</span><br><span class="line">                v2_2 = v0_3;</span><br><span class="line">                v0 = arg35;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                v2_2 = v0_3;</span><br><span class="line">                v0 = arg35;</span><br><span class="line">                <span class="keyword">if</span>(!((a)v0_3.get(arg38.size() - <span class="number">1</span>)).a(v0, ((a)v15_1))) &#123;</span><br><span class="line">                    v2_2.add(v15_1);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            goto label_273;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception v0_1) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Throwable v0_2) &#123;</span><br><span class="line">            miuix.core.util.d.a(v29);</span><br><span class="line">            <span class="keyword">throw</span> v0_2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    label_256:</span><br><span class="line">        v31 = v19;</span><br><span class="line">    label_258:</span><br><span class="line">        v1_2 = v29;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        label_260:</span><br><span class="line">            Log.e(<span class="string">&quot;BehaviorRecord-Utils&quot;</span>, <span class="string">&quot;loadAppBehaviorByPkgNameAndUser error&quot;</span>, v0_1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Throwable v0_2) &#123;</span><br><span class="line">            v29 = v1_2;</span><br><span class="line">            miuix.core.util.d.a(v29);</span><br><span class="line">            <span class="keyword">throw</span> v0_2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        miuix.core.util.d.a(v1_2);</span><br><span class="line">        <span class="keyword">return</span> v31;</span><br><span class="line">        miuix.core.util.d.a(v29);</span><br><span class="line">        <span class="keyword">throw</span> v0_2;</span><br><span class="line">    label_273:</span><br><span class="line">        v15 = v2_2;</span><br><span class="line">        v1_3 = (<span class="type">int</span>)v19;</span><br><span class="line">        v10 = (<span class="type">int</span>)v1_3;</span><br><span class="line">        v9 = v23;</span><br><span class="line">        v8 = v24;</span><br><span class="line">        v6 = v29;</span><br><span class="line">        v11 = v31_1;</span><br><span class="line">        v12 = v32;</span><br><span class="line">        v13 = v33;</span><br><span class="line">        goto label_93;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">label_288:</span><br><span class="line">    miuix.core.util.d.a(v29_1);</span><br><span class="line">    <span class="keyword">return</span> v31;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用的是这个函数<br><code>public a(Context arg3, String arg4, String arg5, String arg6, long arg7, int arg9, int arg10, String arg11, String arg12, int arg13, int arg14, int arg15)</code></p>
<p>v15_1 &#x3D; new a(arg35, arg36, v4_1, v5, v17, v10_1, v20_1, v21_1, v22_1, v25, arg37, 1);  &#x2F;&#x2F; 初始化</p>
<p>public a(Context arg3, String arg4, String arg5, String arg6, long arg7, int arg9, int arg10, String arg11, String arg12, int arg13, int arg14, int arg15) {  &#x2F;&#x2F; 确定行为触发的包名和时间</p>
<p>public String a(Resources arg9) {  &#x2F;&#x2F; 确定行为类型，返回触发时间 “Restricted at 10:15”</p>
<p>整体思路，一个packager uid下调用某个隐私API都会被记录，并存放库中。</p>
<p>隐私沙箱两种方案：</p>
<ol>
<li>更改art编译模式，trace只trace framework层内容，对特定UID的app进行改变art编译模式。</li>
<li>研究MIUI Privacy_Manager 隐私行为功能实现，仿照一份写出来trace。</li>
</ol>
<p>改动art类似于插入式Hook，系统级改动，安全有效，但不确定是否会造成原本正常的app崩溃。</p>
<p>MIUI Privacy_Manager形式更可靠，但是无法选定哪一个UID，以及UID发送给Manager app如何处理。</p>
<p>上次实现的问题是，虽然可以直接改动相应的framework代码，做到那个地方调用，并且能将调用的堆栈，都能够发送，但是对调用的UID为止，并且无法指定UID进行控制，所以不是很符合我的要求。</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/TUGOhost">Projects</a></li>
        
          <li><a href="/books/">books</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">过程</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&text=MIUI隐私行为逆向分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&title=MIUI隐私行为逆向分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&is_video=false&description=MIUI隐私行为逆向分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=MIUI隐私行为逆向分析&body=Check out this article: http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&title=MIUI隐私行为逆向分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&title=MIUI隐私行为逆向分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&title=MIUI隐私行为逆向分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&title=MIUI隐私行为逆向分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&name=MIUI隐私行为逆向分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://tugohost.github.io.com/2023/01/01/MIUI_PrivacyManager/&t=MIUI隐私行为逆向分析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2018-2023
    TUGOhost
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/TUGOhost">Projects</a></li><!--
     --><!--
       --><li><a href="/books/">books</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
